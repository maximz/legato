(function(a){a.fn.feedback=function(k){var j=this;var d={margin:0},g,e,h,c,b;var i=a("<textarea />");var f=a("<button />").text("Preview").click(function(){var n=c.children().clone();c.remove();b.remove();a("#feedback").hide();var l=window.open();var m=l.document;m.write("Loading... Please wait");window.setTimeout(function(){var o=a("body").html2canvas({ready:function(s){var r=s[0];var q=r.getContext("2d");q.strokeStyle="rgb(255,0,0)";q.lineWidth=4;a.each(n,function(u,y){q.moveTo(0,0);var x=parseInt(a(y).css("left"));var w=parseInt(a(y).css("top"));var v=a(y).width();var t=a(y).height();q.strokeRect(x,w,v,t)});var p=r.toDataURL();m.body.innerHTML="";m.write("<h1>Send Feedback</h1><img src='"+p+"' style='border:1px solid black; width:400px;' />");m.write('<br /><br />Message:<br /><textarea style="width:400px;height:200px;">'+i.val()+"</textarea>");m.write("<br /><button>Submit (disabled in the example)</button>");a("#feedback").show()}})},1000)});b=a("<div />").css(d).css({position:"fixed",right:0,bottom:0,background:"#fff","z-index":999}).addClass("feedback-form").append(a("<h2 />").text("Send feedback")).append(a("<label />").text("Describe your problem:")).append(i).append(f).appendTo("body");c=a("<div />").css(d).css({"background-color":"#000",opacity:0.5,position:"absolute",top:0,left:0,width:a(document).width(),height:a(document).height(),margin:0}).appendTo("body").mousedown(function(l){g=a("<div />").css(d).css({position:"absolute",left:l.pageX,top:l.pageY,opacity:1,background:"#fff",cursor:"pointer"}).appendTo(c);e=l.pageX;h=l.pageY;c.bind("mousemove",function(m){g.width(Math.abs(m.pageX-e));g.height(Math.abs(m.pageY-h));if(m.pageX<e){g.css("left",m.pageX)}if(m.pageY<h){g.css("top",m.pageY)}})}).mouseup(function(o){var n=g;var p;var m=false;var l=false;g.click(function(){a(this).remove()});c.unbind("mousemove")})}})(jQuery);