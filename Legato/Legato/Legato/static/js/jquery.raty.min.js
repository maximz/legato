(function(q){q.fn.raty=function(a){if(this.length==0){v("Selector invalid or missing!");return}else{if(this.length>1){return this.each(function(){q.fn.raty.apply(q(this),[a])})}}var d=q.extend({},q.fn.raty.defaults,a),j=q(this),f=this.attr("id"),e=0,i=d.starOn,z="",k=d.target,g=(d.width)?d.width:(d.number*d.size+d.number*4);if(f===undefined){f="raty-"+j.index();j.attr("id",f)}if(d.number>20){d.number=20}else{if(d.number<0){d.number=0}}if(d.path.substring(d.path.length-1,d.path.length)!="/"){d.path+="/"}j.data("options",d);if(!isNaN(parseInt(d.start))&&d.start>0){e=(d.start>d.number)?d.number:d.start}for(var y=1;y<=d.number;y++){i=(e>=y)?d.starOn:d.starOff;z=(y<=d.hintList.length&&d.hintList[y-1]!==null)?d.hintList[y-1]:y;j.append('<img id="'+f+"-"+y+'" src="'+d.path+i+"?"+d.revnum+'" alt="'+y+'" title="'+z+'" class="'+f+'"/>').append((y<d.number)?"&nbsp;":"")}if(d.iconRange&&e>0){u(f,e,d)}var b=q("<input/>",{id:f+"-score",type:"hidden",name:d.scoreName}).appendTo(j);if(e>0){b.val(e)}if(d.half){t(j,q("input#"+f+"-score").val(),d)}if(!d.readOnly){if(k!==null){k=q(k);if(k.length==0){v("Target selector invalid or missing!")}}if(d.cancel){var c=q("img."+f),h='<img src="'+d.path+d.cancelOff+"?"+d.revnum+'" alt="x" title="'+d.cancelHint+'" class="button-cancel"/>';if(d.cancelPlace=="left"){j.prepend(h+"&nbsp;")}else{j.append("&nbsp;").append(h)}q("#"+f+" img.button-cancel").mouseenter(function(){q(this).attr("src",d.path+d.cancelOn);c.attr("src",d.path+d.starOff);s(k,"",d)}).mouseleave(function(){q(this).attr("src",d.path+d.cancelOff);j.mouseout()}).click(function(w){q("input#"+f+"-score").removeAttr("value");if(d.click){d.click.apply(j,[null,w])}});j.css("width",g+d.size+4)}else{j.css("width",g)}j.css("cursor","pointer");o(j,d,k)}else{j.css("cursor","default");m(j,e,d)}return j};function o(f,a,e){var c=f.attr("id"),d=q("input#"+c+"-score"),b=f.children("img."+c);f.mouseleave(function(){r(f,d.val(),a);p(e,d,a)});b.bind(((a.half)?"mousemove":"mouseover"),function(g){u(c,this.alt,a);if(a.half){var h=parseFloat(((g.pageX-q(this).offset().left)/a.size).toFixed(1));h=(h>=0&&h<0.5)?0.5:1;f.data("score",parseFloat(this.alt)+h-1);t(f,f.data("score"),a)}else{u(c,this.alt,a)}s(e,this.alt,a)}).click(function(g){d.val(a.half?f.data("score"):this.alt);if(a.click){a.click.apply(f,[d.val(),g])}})}function p(d,c,b){if(d!==null){var a="";if(b.targetKeep){a=c.val();if(b.targetType=="hint"){if(c.val()==""&&b.cancel){a=b.cancelHint}else{a=b.hintList[Math.ceil(c.val())-1]}}}if(n(d)){d.val(a)}else{d.html(a)}}}function l(c,a,b){var e=undefined;if(a==undefined){v("Specify an ID or class to be the target of the action.");return}if(a){if(a.indexOf(".")>=0){var d;return q(a).each(function(){d="#"+q(this).attr("id");if(b=="start"){q.fn.raty.start(c,d)}else{if(b=="click"){q.fn.raty.click(c,d)}else{if(b=="readOnly"){q.fn.raty.readOnly(c,d)}}}})}e=q(a);if(!e.length){v('"'+a+'" is a invalid identifier for the public funtion $.fn.raty.'+b+"().");return}}return e}function v(a){if(window.console&&window.console.log){window.console.log(a)}}function u(g,e,f){var d=q("img."+g).length,h=0,a=0,i,c;for(var b=1;b<=d;b++){i=q("img#"+g+"-"+b);if(b<=e){if(f.iconRange&&f.iconRange.length>h){c=f.iconRange[h][0];a=f.iconRange[h][1];if(b<=a){i.attr("src",f.path+c)}if(b==a){h++}}else{i.attr("src",f.path+f.starOn)}}else{i.attr("src",f.path+f.starOff)}}}function m(a,c,b){if(c!=0){c=parseInt(c);hint=(c>0&&b.number<=b.hintList.length&&b.hintList[c-1]!==null)?b.hintList[c-1]:c}else{hint=b.noRatedMsg}a.attr("title",hint).children("img").attr("title",hint)}function n(a){return a.is("input")||a.is("select")||a.is("textarea")}function r(a,d,b){var c=a.attr("id");if(isNaN(parseInt(d))){a.children("img."+c).attr("src",b.path+b.starOff);q("input#"+c+"-score").removeAttr("value");return}if(d<0){d=0}else{if(d>b.number){d=b.number}}u(c,d,b);if(d>0){q("input#"+c+"-score").val(d);if(b.half){t(a,d,b)}}if(b.readOnly||a.css("cursor")=="default"){m(a,d,b)}}function s(c,d,b){if(c!==null){var a=d;if(b.targetType=="hint"){if(d==0&&b.cancel){a=b.cancelHint}else{a=b.hintList[d-1]}}if(n(c)){c.val(a)}else{c.html(a)}}}function t(f,d,a){var c=f.attr("id"),b=Math.ceil(d),e=(b-d).toFixed(1);if(e>0.25&&e<=0.75){b=b-0.5;q("img#"+c+"-"+Math.ceil(b)).attr("src",a.path+a.starHalf)}else{if(e>0.75){b--}else{q("img#"+c+"-"+b).attr("src",a.path+a.starOn)}}}q.fn.raty.cancel=function(b,c){var a=(c===undefined)?false:true;if(a){q.fn.raty.click("",b,"cancel")}else{q.fn.raty.start("",b,"cancel")}return q.fn.raty};q.fn.raty.click=function(c,a){var d=l(c,a,"click"),b=q(a).data("options");r(d,c,b);if(b.click){b.click.apply(d,[c])}else{v('You must add the "click: function(score, evt) { }" callback.')}return q.fn.raty};q.fn.raty.readOnly=function(d,a){var e=l(d,a,"readOnly"),b=q(a).data("options"),c=e.children("img.button-cancel");if(c[0]){(d)?c.hide():c.show()}if(d){q("img."+e.attr("id")).unbind();e.css("cursor","default").unbind()}else{o(e,b);e.css("cursor","pointer")}return q.fn.raty};q.fn.raty.start=function(c,a){var d=l(c,a,"start"),b=q(a).data("options");r(d,c,b);return q.fn.raty};q.fn.raty.defaults={cancel:false,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:null,half:false,hintList:["bad","poor","regular","good","gorgeous"],noRatedMsg:"not rated yet",number:5,path:"img/",iconRange:[],readOnly:false,revnum:"1",scoreName:"score",size:16,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",start:0,target:null,targetKeep:false,targetType:"hint",width:null}})(jQuery);