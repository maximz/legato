var Legato=Legato||{};(function(a){Legato.MessageBubble=function(c){var b=this;this.id="";this.index={};this.location="";this.label="";this.count="";this.element=a(c);this.labelHeightOpen=0;this.labelHeightClosed=0;this.locationHeightOpen=0;this.locationHeightClosed=0;this.empty=a("<div>").css("display","block");this.csstransitions=a("html").hasClass("csstransitions");this.dom={location:a(".location",this.element),label:a(".label",this.element),count:a(a(".count",this.element).find("span")[0]),lower:a(".lower",this.element),text:a(".text",this.element),dot:a(".dot",this.element)};this._onMouseClick=function(d){b.onMouseClick(d)};this._onMouseOver=function(d){b.onMouseOver(d)};this._onMouseOut=function(d){b.onMouseOut(d)};this._appear=function(){b.appear()};this._update=function(){b.update()};this.delay={update:null,show:null,hide:null};this.element.bind("mouseenter",this._onMouseOver);this.element.bind("mouseleave",this._onMouseOut);this.element.bind("click",this._onMouseClick);if(this.csstransitions!==true){this.initContentSlide()}this.element.data("MessageBubble",this);this.element.data("locked",false)};Legato.MessageBubble.prototype.appear=function(c){var b=this;if(typeof(c)==="undefined"){c=500}this.element.css("visibility","visible");this.dom.text.stop().delay(c).animate({opacity:1},c*0.5,function(){b.dom.dot.attr("style","")});if(this.csstransitions===true){this.setTransition(this.dom.dot,"transform",c,"cubic-bezier(0.230, 1.000, 0.320, 1.000)");this.setScale(this.dom.dot,1)}else{this.dom.dot.stop().animate({opacity:1},c,"easeOutQuad")}setTimeout(function(){b.element.addClass("enabled")},c+200)};Legato.MessageBubble.prototype.disappear=function(c){var b=this;if(typeof(c)==="undefined"){c=500}if(c===0){this.element.css("visibility","hidden")}this.dom.text.stop().animate({opacity:0},c*0.5,function(){if(b.csstransitions===true){b.setTransition(b.dom.dot,"transform",c,"ease-in-out");b.setScale(b.dom.dot,0)}else{b.dom.dot.stop().animate({opacity:0},c,"easeInOutQuad")}});this.element.removeClass("enabled")};Legato.MessageBubble.prototype.open=function(){if(this.csstransitions!==true){this.dom.label.stop().animate({opacity:1},150)}};Legato.MessageBubble.prototype.close=function(){if(this.csstransitions!==true){this.dom.label.stop().animate({opacity:0},150)}};Legato.MessageBubble.prototype.refresh=function(b){if(typeof(b)==="undefined"){return}this.id=b.id;this.location=b.address;this.label=b.label;this.count=b.count;this.disappear();clearTimeout(this.delay.update);clearTimeout(this.delay.show);this.delay.update=setTimeout(this._update,1200);this.delay.show=setTimeout(this._appear,1200)};Legato.MessageBubble.prototype.initContentSlide=function(){var b=this;this.labelHeightClosed=this.dom.label.height();this.locationHeightClosed=this.dom.location.height();this.dom.lower.bind("mouseenter",function(){if(b.element.hasClass("enabled")!==true){return}if(b.labelHeightOpen===0){b.labelHeightOpen=b.dom.label.height();b.dom.label.height(b.labelHeightClosed)}b.dom.label.stop().animate({height:b.labelHeightOpen},250,"easeInOutQuad")});this.dom.location.bind("mouseenter",function(){if(b.element.hasClass("enabled")!==true){return}if(b.locationHeightOpen===0){b.locationHeightOpen=b.dom.location.height();b.dom.location.height(b.locationHeightClosed)}b.dom.location.stop().animate({height:b.locationHeightOpen},250,"easeInOutQuad")});this.dom.lower.bind("mouseleave",function(){b.dom.label.stop().animate({height:b.labelHeightClosed},250,"easeInOutQuad")});this.dom.translated.bind("mouseleave",function(){b.dom.location.stop().animate({height:b.locationHeightClosed},250,"easeInOutQuad")})};Legato.MessageBubble.prototype.update=function(){this.element.attr("href","/Instruments/Listing/"+this.id);this.dom.label.text(this.label);this.dom.location.text(this.location);this.dom.count.text(this.count)};Legato.MessageBubble.prototype.truncate=function(h,c,e){if(typeof(this.index[h+e])!=="undefined"){c.html(this.index[h+e]);return}this.empty.css({"line-height":c.css("line-height"),"font-family":c.css("font-family"),"text-align":c.css("text-align"),"font-size":c.css("font-size"),width:c.css("width")});a("body").append(this.empty);this.empty.text(h);var g=parseInt(c.css("line-height"),10);var b=g*e;var f=h.length;while(this.empty.height()>b&&--f){this.empty.text(h.substr(0,f))}var d;if(f!==h.length){d=this.index[h+e]=h.substr(0,f-3)+"&hellip;"}else{d=h}this.index[h+e]=d;c.html(d);this.empty.remove()};Legato.MessageBubble.prototype.setTransition=function(d,g,e,f){g=g||"all";e=e||"250";f=f||"ease-in-out";var b=(g==="transform");var c=g+" "+e+"ms "+f;d.css({"-webkit-transition":b?"-webkit-"+c:c,"-moz-transition":b?"-moz-"+c:c,"-o-transition":b?"-o-"+c:c,transition:c})};Legato.MessageBubble.prototype.setScale=function(c,d){var b="scale("+d+")";c.css({"-webkit-transform":b,"-moz-transform":b,"-o-transform":b,transform:b})};Legato.MessageBubble.prototype.onMouseClick=function(b){};Legato.MessageBubble.prototype.onMouseOver=function(b){if(this.element.hasClass("enabled")!==true){return}this.element.data("locked",true);this.open()};Legato.MessageBubble.prototype.onMouseOut=function(b){if(this.element.hasClass("enabled")!==true){return}this.element.data("locked",false);this.close()};a.fn.messageBubble=function(){return this.each(function(){(new Legato.MessageBubble(this))})}})(jQuery);