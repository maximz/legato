var EarthMapType=(function(){function j(){if(console&&console.log){console.log(arguments)}else{alert(arguments)}}function h(){var l=[window.location.protocol,"//",window.location.host];l=l.concat(arguments.length>0?arguments:[]);return l.join("")}function d(m){if(!m){return[0,0]}var l=d(m.offsetParent);return[m.offsetLeft+l[0],m.offsetTop+l[1]]}function e(n,m,o){function l(){if(o&&o.extendBefore){m.apply(this,arguments)}n.apply(this,arguments);if(!o||!o.extendBefore){m.apply(this,arguments)}}if(o&&o.prototype){l.prototype=new n()}return l}function a(){var l=document.createElement("IFRAME");l.src="javascript:false";l.style.position="absolute";l.style.border="none";return l}var b=-7;function c(n,l){var m=d(l);n.style.visibility="visible";n.style.width=l.offsetWidth+"px";n.style.height=l.offsetHeight+"px";n.style.left=m[0]+b+"px";n.style.top=m[1]+b+"px";l.parentNode.appendChild(n);l.style.zIndex=n.style.zIndex+1}var g=(function(){function l(){this.map={};this.next_id=0;this.name="earthlink";this.id_name=["__",this.name,"_id"].join("")}l.prototype.getId=function(m){if(m[this.id_name]===null||m[this.id_name]==undefined){m[this.id_name]=this.next_id;this.next_id+=1}return m[this.id_name]};l.prototype.add=function(n){var m=this.getId(n);if(!this.map[m]){this.map[m]=n;google.maps.event.trigger(this,"insert",n)}};l.prototype.remove=function(n){var m=this.getId(n);if(this.map[m]){delete this.map[m];google.maps.event.trigger(this,"remove",n)}};l.prototype.contains=function(n){var m=this.getId(n);if(this.map[m]){return true}return false};l.prototype.forEach=function(n){for(var m in this.map){this.map.hasOwnProperty(m)&&n.call(this,this.map[m])}};return l})();function f(p){var n=this;this.bindTo("linker",p);this.bindTo("earth_plugin",p);this.rTzRatio=0.6;this.map_earth={};this.earth_map={};function m(){this._map&&this._map[n.get("linker").name].remove(this);(this._map=this.get("map"))&&this._map[n.get("linker").name].add(this)}google.maps.MarkerImage=e(google.maps.MarkerImage,function(s,u,q,r,t){this.url=s;this.origin=q},{prototype:true});google.maps.Marker.prototype.map_changed=e(google.maps.Marker.prototype.map_changed,m);google.maps.Polyline.prototype.map_changed=e(google.maps.Polyline.prototype.map_changed,m);google.maps.Polygon.prototype.map_changed=e(google.maps.Polygon.prototype.map_changed,m);google.maps.Circle.prototype.map_changed=e(google.maps.Circle.prototype.map_changed,m);google.maps.Rectangle.prototype.map_changed=e(google.maps.Rectangle.prototype.map_changed,m);google.maps.KmlLayer.prototype.map_changed=e(google.maps.KmlLayer.prototype.map_changed,m);function o(q){n.insert(q)}function l(q){n.remove(q)}this.get("linker").forEach(o);google.maps.event.addListener(this.get("linker"),"insert",o);google.maps.event.addListener(this.get("linker"),"remove",l)}function k(m,n,l,o){m.push(google.maps.event.addListener(n,l,o));o()}f.prototype=new google.maps.MVCObject();f.prototype.insert=function(l){var m=this;function n(p,o,r){if(!o){return}var q=m.get("earth_plugin");q.getFeatures().appendChild(o);m.map_earth[m.get("linker").getId(p)]=[o,r];m.earth_map[o]=p}if(l instanceof google.maps.Marker){this.createMarker(l,n)}else{if(l instanceof google.maps.Polyline){this.createPolyline(l,n)}else{if(l instanceof google.maps.Polygon){this.createPolygon(l,n)}else{if(l instanceof google.maps.KmlLayer){this.createKmlLayer(l,n)}else{if(l instanceof google.maps.Circle){this.createCircle(l,n)}else{if(l instanceof google.maps.Rectangle){this.createRectangle(l,n)}else{j("unrecognized",l)}}}}}}};f.prototype.remove=function(l){var p=this.get("earth_plugin");var m=this.get("linker").getId(l);var q=this.map_earth[m];var n=q[0];var o=q[1];if(o){o.forEach(function(r){google.maps.event.removeListener(r)})}p.getFeatures().removeChild(n);this.map_earth[m]=null;this.earth_map[n]=null};f.prototype.rangeToZoom=function(l){return Math.round(26-(Math.log(l*this.rTzRatio)/Math.log(2)))};f.prototype.zoomToRange=function(l){return Math.pow(2,26-l)/this.rTzRatio};f.prototype.hexColorAndAlphaToEarthColor=function(p,q){if(p&&p[0]=="#"){p=p.slice(1)}if(!p||(p.length!=6&&p.length!=3)){p="#ff000000"}if(p.length==3){p=[p[0],p[0],p[1],p[1],p[2],p[2]].join("")}var o=p.slice(0,2);var n=p.slice(2,4);var l=p.slice(4,6);var m=Math.floor(parseInt("ff",16)*q).toString(16);if(m.length<2){m="0"+m}return["#",m,l,n,o].join("")};f.prototype.makeCircleLinearRing=function(u,l,m,p){var n=u.createLinearRing("");var t=25;var q=Math.PI*2;for(var o=0;o<t;o++){var r=l+p*Math.cos(o/t*q);var s=m+p*Math.sin(o/t*q);n.getCoordinates().pushLatLngAlt(r,s,0)}return n};f.prototype.createMarker=function(n,r){var q=this.get("earth_plugin");var p=new google.maps.MVCArray();var o=q.createPlacemark("");var l=q.createPoint("");k(p,n,"position_changed",function(){var s=n.getPosition();if(s){l.setLatLng(s.lat(),s.lng());o.setGeometry(l)}});function m(){if(n.getIcon()){var s=n.getIcon().url;var w=s;if(w[0]=="/"){w=h()+w}var v=new Image();v.src=w;v.onload=function(){var z=v.height;var B=n.getIcon().size.width,y=n.getIcon().size.height;var A=q.parseKml(["<Style>","<IconStyle>","<Icon>","</Icon>","</IconStyle>","</Style>"].join(""));var x=n.getIcon().anchor;A.getIconStyle().getHotSpot().set(x.x,q.UNITS_PIXELS,y-x.y,q.UNITS_PIXELS);A.getIconStyle().getIcon().setHref(w);A.getIconStyle().setScale(Math.min(B,y)/32);o.setStyleSelector(A)}}else{var u=q.createStyle("");var t=q.createIcon("");t.setHref("http://maps.google.com/mapfiles/kml/paddle/red-circle.png");u.getIconStyle().getHotSpot().set(32,q.UNITS_PIXELS,1,q.UNITS_PIXELS);u.getIconStyle().setIcon(t);u.getIconStyle().setScale(1);o.setStyleSelector(u)}}k(p,n,"icon_changed",m);k(p,n,"title_changed",function(){var s=n.getTitle();if(s){o.setName(s)}else{o.setName("")}});k(p,n,"visible_changed",function(){if(n.getVisible()===false){o.setVisibility(false)}else{o.setVisibility(true)}});r(n,o,p)};f.prototype.makePathListener=function(m,l,o){var n=new google.maps.MVCArray();n.push(google.maps.event.addListener(l,"insert_at",function(u){var p=l.getAt(u);var q=o.getLength();if(u<q/2){var t=[];for(var s=0;s<u;s+=1){t.push(o.shift())}o.unshiftLatLngAlt(p.lat(),p.lng(),0);for(var s=0;s<t.length;s+=1){o.unshift(t[s])}}else{var r=[];for(var s=u;s<q-1;s+=1){r.push(o.get(s))}o.pushLatLngAlt(p.lat(),p.lng(),0);for(var s=0;s<r.length;s+=1){o.push(r[s])}}}));n.push(google.maps.event.addListener(l,"remove_at",function(t,p){var q=o.getLength();if(t<q/2){var s=[];for(var r=0;r<t;r+=1){s.push(o.shift())}o.shift();for(var r=0;r<s.length;r+=1){o.unshift(s[r])}}else{for(var r=t;r<q-2;r+=1){o.set(r,o.get(r+1))}o.pop()}}));n.push(google.maps.event.addListener(l,"set_at",function(q,r){var p=l.getAt(q);o.setLatLngAlt(q,p.lat(),p.lng(),0)}));l.forEach(function(p){o.pushLatLngAlt(p.lat(),p.lng(),0)});return n};f.prototype.createPolyline=function(s,n){var u=this;var r=this.get("earth_plugin");var p=r.createPlacemark("");var o=r.createLineString("");var l=s.getPath();var t=o.getCoordinates();o.setTessellate(true);var q=this.makePathListener(p,l,t);p.setGeometry(o);var m=r.createStyle("");p.setStyleSelector(m);k(q,s,"style_changed",function(){var v=s.get("style")||{};m.getLineStyle().setWidth(v.strokeWeight||2);m.getLineStyle().getColor().set(u.hexColorAndAlphaToEarthColor(v.strokeColor||"000000",v.strokeOpacity||1))});n(s,p,q)};f.prototype.createPolygon=function(s,n){var v=this;var r=this.get("earth_plugin");var o=r.createPlacemark("");var m=r.createPolygon("");var u=r.createLinearRing("");m.setOuterBoundary(u);var l=s.getPath();var t=u.getCoordinates();var q=this.makePathListener(o,l,t);o.setGeometry(m);var p=r.createStyle("");o.setStyleSelector(p);k(q,s,"style_changed",function(){var w=s.get("style")||{};p.getLineStyle().getColor().set(v.hexColorAndAlphaToEarthColor(w.strokeColor||"000000",w.strokeOpacity||1));p.getPolyStyle().getColor().set(v.hexColorAndAlphaToEarthColor(w.fillColor||"000000",w.fillOpacity||0.5))});n(s,o,q)};f.prototype.createKmlLayer=function(l,n){var m=this.get("earth_plugin");if(!l.kmlobj){google.earth.fetchKml(m,l.url,function(o){if(o){l.kmlobj=o;n(l,l.kmlobj)}})}else{n(l,l.kmlobj)}};f.prototype.createCircle=function(l,o){var t=this;var r=this.get("earth_plugin");var q=new google.maps.MVCArray();var n=r.createPlacemark("");n.setGeometry(r.createPolygon(""));function s(){var u=l.getCenter();n.getGeometry().setOuterBoundary(t.makeCircleLinearRing(r,u.lat(),u.lng(),l.getRadius()/Math.pow(10,5)))}k(q,l,"center_changed",s);k(q,l,"radius_changed",s);s();var m=r.createStyle("");n.setStyleSelector(m);function p(){m.getLineStyle().getColor().set(t.hexColorAndAlphaToEarthColor(l.get("strokeColor")||"000000",l.get("strokeOpacity")||1));m.getLineStyle().setWidth(l.get("strokeWeight")||2);m.getPolyStyle().getColor().set(t.hexColorAndAlphaToEarthColor(l.get("fillColor")||"000000",l.get("fillOpacity")||0.5))}k(q,l,"fillcolor_changed",p);k(q,l,"fillopacity_changed",p);k(q,l,"strokecolor_changed",p);k(q,l,"strokeopacity_changed",p);k(q,l,"strokeweight_changed",p);o(l,n)};f.prototype.createRectangle=function(q,n){var u=this;var t=this.get("earth_plugin");var p=new google.maps.MVCArray();var r=t.createPlacemark("");r.setGeometry(t.createPolygon(""));var m=t.createLinearRing("");var s=m.getCoordinates();r.getGeometry().setOuterBoundary(m);k(p,q,"bounds_changed",function(){var w=q.getBounds();var v=w.getSouthWest();var x=w.getNorthEast();s.clear();s.pushLatLngAlt(v.lat(),v.lng(),0);s.pushLatLngAlt(x.lat(),v.lng(),0);s.pushLatLngAlt(x.lat(),x.lng(),0);s.pushLatLngAlt(v.lat(),x.lng(),0);s.pushLatLngAlt(v.lat(),v.lng(),0)});var l=t.createStyle("");r.setStyleSelector(l);function o(){l.getLineStyle().getColor().set(u.hexColorAndAlphaToEarthColor(q.get("strokeColor")||"000000",q.get("strokeOpacity")||1));l.getLineStyle().setWidth(q.get("strokeWeight")||2);l.getPolyStyle().getColor().set(u.hexColorAndAlphaToEarthColor(q.get("fillColor")||"000000",q.get("fillOpacity")||0.5))}k(p,q,"fillcolor_changed",o);k(p,q,"fillopacity_changed",o);k(p,q,"strokecolor_changed",o);k(p,q,"strokeopacity_changed",o);k(p,q,"strokeweight_changed",o);n(q,r)};function i(l){this.setMap(l)}i.prototype=new google.maps.OverlayView();i.prototype.tileSize=new google.maps.Size(10000,10000);i.prototype.maxZoom=19;i.prototype.name="Earth";i.prototype.alt="Show 3D earth";i.prototype.getTile=function(n,m,l){return l.createElement("DIV")};i.prototype._withEarth=function(n){var l=200,o=50,m=this;(function(){var p=m.get("earth_plugin");if(!p&&l>0){l-=1;return setTimeout(arguments.callee,o)}if(l<=0){j(["ERROR: No earth plugin object was found in a ","reasonable time frame."].join(""));return}n(p)})()};i.prototype._initEarth=function(o){var m=this;this.set("earth_plugin",o);this.mapper=new f(this);o.getWindow().setVisibility(true);this.get("container_earth").childNodes[0].style.zIndex=1001;this.get("container_earth").style.visibility="hidden";google.earth.addEventListener(o.getWindow(),"mouseout",function(){o.getWindow().blur()});google.maps.event.addListener(this,"atmosphere_changed",function(){if(m.get("atmosphere")){o.getOptions().setAtmosphereVisibility(true)}else{o.getOptions().setAtmosphereVisibility(false)}});google.maps.event.addListener(this,"graticules_changed",function(){if(m.get("graticules")){o.getOptions().setGridVisibility(true)}else{o.getOptions().setGridVisibility(false)}});var q=o.getWindow();var n=false;function p(r){return{latLng:new google.maps.LatLng(r.getLatitude(),r.getLongitude())}}function l(r,s){google.earth.addEventListener(q,r,function(t){if(t.getDidHitGlobe()){google.maps.event.trigger(map,s?s:r,p(t))}})}l("click");l("dblclick","doubleclick");l("mouseover");google.earth.addEventListener(q,"mousedown",function(r){n=true;if(r.getDidHitGlobe()){google.maps.event.trigger(map,"mousedown",p(r))}});google.earth.addEventListener(q,"mouseup",function(r){n=false;google.maps.event.trigger(map,"mouseup",p(r))});l("mouseout");google.earth.addEventListener(q,"mousemove",function(r){if(r.getDidHitGlobe()){google.maps.event.trigger(map,"mousemove",p(r));if(n){google.maps.event.trigger(map,"drag")}}});this.jumpToCenter(o);google.maps.event.trigger(this,"initialized",true)};i.prototype.getDiv=function(){var l=this._map||this.get("map");return l.getDiv().childNodes[0]};i.prototype.onAdd=function(){var l=this;var n=this.getMap();this._map=n;this.set("linker",new g());n.mapTypes.set(this.name,this);n[this.get("linker").name]=this.get("linker");this[this.get("linker").name]=this.get("linker");this.set("maptypeid_listener",google.maps.event.addListener(n,"maptypeid_changed",function(){if(n.getMapTypeId()==l.name){l.show()}else{l.set("previousMapTypeId",n.getMapTypeId());l.get("showing")&&l.hide()}}));if(window.Graticule){this.set("overlay_graticules",new Graticule(n));this.get("overlay_graticules").hide()}var m=document.createElement("DIV");m.id="CONTAINER_EARTH";m.style.width="100%";m.style.height="100%";m.style.visibility="hidden";this.getDiv().appendChild(m);this.set("container_earth",m);var o=a();o.style.zIndex=1000;this.set("shim",o);google.maps.event.addListener(this,"graticules_changed",function(){if(l.get("graticules")){if(l.get("overlay_graticules")){l.get("overlay_graticules").show();l.get("overlay_graticules").draw()}}else{if(l.get("overlay_graticules")){l.get("overlay_graticules").hide()}}});if(google.earth){google.earth.createInstance(m,function(p){try{l._initEarth(p)}catch(q){j("Unable to initEarth");google.maps.event.trigger(l,"initialized",false);throw q}},function(p){j("Unable to initialize Google Earth plugin:",p);google.maps.event.trigger(l,"initialized",false)})}else{j("Why did you include this library?")}};i.prototype.onRemove=function(){this._map.mapTypes.set(this.name,null);google.maps.event.removeListener(this.get("maptypeid_listener"));this.getDiv().removeChild(this.get("container_earth"));this._map=null;this.get("shim").parentNode.removeChild(this.get("shim"))};i.prototype.draw=function(){};i.prototype._flyToAtSpeed=function(l,o,n){var m=l.getOptions().getFlyToSpeed();l.getOptions().setFlyToSpeed(n?n:l.SPEED_TELEPORT);l.getView().setAbstractView(o);l.getOptions().setFlyToSpeed(m)};i.prototype.show=function(){var v=this.get("earth_plugin");var m=this.get("map");if(!v){this.get("container_earth").style.visibility="inherit";this.set("showing",true);return}var o=this.get("shim");var q=this.get("map").getDiv().firstChild.children;var w=null;for(var r=0;r<q.length;r+=1){var s=q[r];if(s.className.indexOf("gmnoprint")>-1){var n=s.children;var y=false;for(var p=0;p<n.length;p+=1){if(n[p].title.indexOf("Change map style")>-1){y=true;break}}if(y){w=s;break}}}j(w);if(w){w.onmousedown=function(){c(o,w)};w.onmousemove=function(){var z=1500;setTimeout(w.onmousedown,z)};c(o,w);w.style.zIndex=Number(o.style.zIndex)+1}var t={};t.scrollwheel=m.get("scrollwheel");m.set("scrollwheel",false);if(m.get("zoomControl")!=false){var x={};x[google.maps.ZoomControlStyle.LARGE]=v.NAVIGATION_CONTROL_LARGE;x[google.maps.ZoomControlStyle.SMALL]=v.NAVIGATION_CONTROL_SMALL;v.getNavigationControl().setVisibility(v.VISIBILITY_AUTO);v.getNavigationControl().setStreetViewEnabled(m.get("streetViewControl")!==false);var u=v.getNavigationControl().getScreenXY();u.setXUnits(v.UNITS_PIXELS);v.getNavigationControl().setControlType(x[google.maps.ZoomControlStyle.LARGE]);if(m.get("zoomControl")==true){var l=m.get("zoomControlOptions");if(l){v.getNavigationControl().setControlType(x[l.style])}}}t.zoomControl=m.get("zoomControl");m.set("zoomControl",false);if(this.get("previousMapTypeId")==google.maps.MapTypeId.HYBRID||this.get("previousMapTypeId")==google.maps.MapTypeId.ROADMAP||this.get("previousMapTypeId")==google.maps.MapTypeId.TERRAIN){v.getLayerRoot().enableLayerById(v.LAYER_ROADS,true);v.getLayerRoot().enableLayerById(v.LAYER_BORDERS,true)}else{v.getLayerRoot().enableLayerById(v.LAYER_ROADS,false);v.getLayerRoot().enableLayerById(v.LAYER_BORDERS,false)}this.jumpToCenter(v);this.get("container_earth").style.visibility="inherit";this.set("map_state",t);this.set("showing",true)};i.prototype.jumpToCenter=function(m){var l=this.get("map").getCenter();var n=m.createLookAt("");n.set(l.lat(),l.lng(),0,m.ALTITUDE_CLAMP_TO_GROUND,0,0,this.mapper.zoomToRange(this.get("map").getZoom()));this._flyToAtSpeed(m,n);n.setTilt(30);this._flyToAtSpeed(m,n,1)};i.prototype.hide=function(){var n=this.get("earth_plugin");if(!n){this.get("container_earth").style.visibility="hidden";this.set("showing",false);return}if(this.get("shim")){this.get("shim").style.visibility="hidden"}var r=n.getView().copyAsLookAt(n.ALTITUDE_CLAMP_TO_GROUND);var o=this.mapper.rangeToZoom(r.getRange());var m=this.mapper.zoomToRange(o);var q=this.get("map");q.setZoom(o);q.setCenter(new google.maps.LatLng(r.getLatitude(),r.getLongitude()));var s=false;var l=this;function p(){var t=l.get("map_state");q.set("scrollwheel",t.scrollwheel);q.set("zoomControl",t.zoomControl);if(s){google.earth.removeEventListener(n.getView(),"viewchangeend",arguments.callee)}l.get("container_earth").style.visibility="hidden";l.set("showing",false)}if(r.getHeading()!=0||r.getTilt()!=0||m!=r.getRange()){r.setRange(m);r.setHeading(0);r.setTilt(0);s=true;google.earth.addEventListener(n.getView(),"viewchangeend",p);this._flyToAtSpeed(n,r,4.5)}else{p()}};return i})();