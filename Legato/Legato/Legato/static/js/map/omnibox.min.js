var Legato=Legato||{};(function(){var a=function(){var b=this;this.omni=null;this.getSearchUrl=function(){return"/Instruments/AJAX/SearchInsIds"};this.init=function(){b.omni=$("#q");b.omni.keypress(function(d){var c=(d.keyCode?d.keyCode:d.which);if(c==13){if(b.isDeviceId(b.omni.val())){spinner(true);$.getJSON(this.getSearchUrl()+"?strId="+b.isDeviceId(b.omni.val()),function(e){spinner(false);if(e==null){alert("Invalid device ID.");return}Legato.map.smartPanTo(new google.maps.LatLng(e[0].lat,e[0].lng));return})}else{Legato.map.geocodeAddress(b.omni.val())}}});b.omni.autocomplete({source:Legato.map.markers.concat(Legato.instypes),select:function(c,d){if(d.item&&d.item.omniType){if(d.item.omniType=="type"){if(d.item.id==-1){Legato.map.unfilterMarkers()}else{Legato.map.filterMarkers(d.item.id)}}else{if(d.item.omniType=="marker"){Legato.map.panToMarker(d.item);Legato.map.unfilterMarkers()}}}}})};this.doSearch=function(){var c=[];var d=b.omni.val();$.each(Legato.map.markers,function(e,f){if(f.label.contains(d)){c.push(f)}})};this.isDeviceId=function(c){var d=/(([a-zA-Z][0-9]{2}){2})[0-9]{3}/;if(c==null){return null}if(c.match(d)){return c.match(d)[0]}else{return null}}};Legato.omnibox=new a()})();