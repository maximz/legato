(function(a){a.fn.html2canvas=function(g){var q=a.extend({logging:false,canvasLeft:0,canvasTop:0,ready:function(){}},a.fn.html2canvas.defaults,g);var s=parseInt(a(this).css("margin-left"));var k=parseInt(a(this).css("margin-top"));var e=a("<canvas />").attr("width",a(document).width()+100).attr("height",a(document).height()+100).css("position","absolute").css("left",q.canvasLeft).css("top",q.canvasTop).attr("title","Shift-Click to open image only");a(window).scrollTop(0);if(typeof FlashCanvas!="undefined"){FlashCanvas.initElement(e[0])}var v=e[0].getContext("2d");var c;var l=0;var n=[];var d=a(this);function j(A){if(q.logging){console.log(A)}}t(d);a.each(document.images,function(A,B){b(a(B).attr("src"))});if(n.length==0){i()}function i(){if(n.length==0||l==n.length/2){j("Started parsing");r(d);z(d)}}function b(B){if(n.indexOf(B)==-1){n.push(B);var A=new Image();a(A).load(function(){l++;i()});A.onerror=function(){n.splice(n.indexOf(A.src),2);l++;i()};A.src=B;n.push(A)}}function t(C,A){a(C).contents().each(function(F,E){t(E,A)});if(C.nodeType==1||typeof C.nodeType=="undefined"){var B=a(C).css("background-image");if(B&&B!="1"&&B!="none"){var D=p(B);b(D,A)}}}function m(A){r(A);if(A.nodeName!="IFRAME"){if(a(A).contents().length==1){if(a(A).contents()[0].nodeType==1){m(a(A).contents()[0])}else{h(A,a(A).contents()[0])}}else{a(A).contents().each(function(C,B){if(B.nodeType==1){m(B)}else{if(B.nodeType==3){h(A,B)}}})}}}function z(A){a(A).children().each(function(B,C){m(C)});u()}function p(A){if(A.substr(0,5)=='url("'){A=A.substr(5);A=A.substr(0,A.length-2)}else{A=A.substr(4);A=A.substr(0,A.length-1)}return A}function f(B){var A=n.indexOf(B);if(A!=-1){return n[A+1]}else{return false}}function w(B,A,C){v.drawImage(B,A,C)}function r(D){if(D.getBoundingClientRect){var J=D.getBoundingClientRect();var L=J.left;var K=J.top;var M=J.width;var T=J.height}else{var O=a(D).offset();var L=O.left+parseInt(a(D).css("border-left-width"));var K=O.top+parseInt(a(D).css("border-top-width"));var M=a(D).innerWidth();var T=a(D).innerHeight()}var B=a(D).css("background-color");var P=a(D).css("background-image");var N=a(D).css("background-repeat");var V=a(D).css("background-position");var G=parseInt(a(D).css("border-top-width"));var H=a(D).css("border-top-color");var C=parseInt(a(D).css("border-right-width"));var E=a(D).css("border-right-color");var Q=parseInt(a(D).css("border-bottom-width"));var S=a(D).css("border-bottom-color");var U=parseInt(a(D).css("border-left-width"));var A=a(D).css("border-left-color");if(G>0){o(L-U,K-G,M+U+C,G,H)}if(U>0){o(L-U,K,U,T,A)}if(C>0){o(L+M,K,C,T,E)}if(Q>0){o(L-U,K+T,M+U+C,Q,S)}o(L,K,M,T,B);if(P&&P!="1"&&P!="none"){P=p(P);image=f(P);var F=V.split(" ");var I=parseInt(F[0]);var R=parseInt(F[1]);if(image){switch(N){case"repeat-x":for(bgx=(L+I);bgx<=M+L;){if(Math.floor(bgx+image.width)>M+L){v.drawImage(image,bgx,(K+R),(M+L)-bgx,Math.min(image.height,T))}else{v.drawImage(image,bgx,(K+R))}bgx=Math.floor(bgx+image.width)}break;case"repeat-y":for(bgy=(K+R);bgy<=T+K;){if(Math.floor(bgy+image.height)>T+K){v.drawImage(image,(L+I),bgy,Math.min(image.width,M),(T+K)-bgy)}else{v.drawImage(image,(L+I),bgy)}bgy=Math.floor(bgy+image.height)}break;case"no-repeat":w(image,(L+I),(K+R));break}}else{j("Error loading background:"+P)}}if(D.nodeName=="IMG"){image=f(a(D).attr("src"));if(image){w(image,L,K)}else{j("Error loading <img>:"+a(D).attr("src"))}}}function o(A,E,C,D,B){if(B!="transparent"){v.fillStyle=B;v.fillRect(A,E,C,D)}}function x(B,A,C){if(a.trim(B).length>0){v.fillText(B,A,C)}}function h(A,M){var P=a(A).css("text-align");var R=a(A).css("font-family");var K=a(A).css("font-size");var O=a(A).css("color");var I=a.trim(a(A).text());var L=a(A).css("font-weight");var G=a(A).css("font-style");var N=parseInt(a(A).css("line-height"));var J=a(A).width();var Q=a(A).css("text-transform");var T=a(A).css("text-decoration");var I=M.nodeValue;switch(Q){case"lowercase":M.nodeValue=I.toLowerCase();break;case"capitalize":M.nodeValue=I.replace(/(^|\s)([a-z])/g,function(U,W,V){return W+V.toUpperCase()});break;case"uppercase":M.nodeValue=I.toUpperCase();break}if(I.length>0){switch(L){case"401":L="bold";break}v.font=L+" "+G+" "+K+" "+R;v.fillStyle=O;v.textBaseline="bottom";var C=M;for(var S=0;S<I.length;S++){var E=C.splitText(1);var F=C.parentNode;var B=document.createElement("wrapper");var H=C.cloneNode(true);B.appendChild(C.cloneNode(true));F.replaceChild(B,C);if(B.getBoundingClientRect){var D=B.getBoundingClientRect()}else{var D={}}F.replaceChild(H,B);x(C.nodeValue,D.left,D.bottom);if(T=="underline"){o(D.left,D.bottom,D.width,1,O)}C=E}}}function u(){j("Finished");q.ready(e)}var y=a("p").position();j("Reached the end")}})(jQuery);