Legato.map.init();google.maps.event.addListenerOnce(Legato.map.map,"tilesloaded",function(){Legato.map.loadMarkerData()});var mapVersionCookieName="legatomap_useold";var cookieSettings={expires:30,path:"/"};var cookieCheck=function(){var a=$.cookie(mapVersionCookieName);if(!oldMap&&(a!=null&&a=="true")){redirectToMap(true);return}if(oldMap&&(a==null||a!="true")){redirectToMap(false);return}};$(document).ready(function(){cookieCheck();Legato.instypes=[];$.getJSON("/Instruments/AJAX/GetTypes",function(g){$.each(g,function(h,j){j.omniType="type";j.label=j.name;Legato.instypes.push(j);$('<input type="radio" name="selectedType" />').val(j.id).attr("id","type-"+j.id).appendTo("#chooseTypeInputs");$("<label></label>").html(j.name).attr("for","type-"+j.id).appendTo("#chooseTypeInputs");$("<br/>").appendTo("#chooseTypeInputs")})});var c={};c.label="All";c.name="All";c.id=-1;c.omniType="type";Legato.instypes.push(c);$("#chooseMarkerSize #markerSizeSelect").slider({value:1,min:1,max:3,step:0.5,slide:function(g,h){$("#chooseMarkerSize #amount").val(h.value)}});$("#chooseMarkerSize #amount").val($("#chooseMarkerSize #markerSizeSelect").slider("value"));$("#chooseMarkerSize .submitButton").click(function(g){g.preventDefault();Legato.map.markerSize=parseInt($("#chooseMarkerSize #amount").val());Legato.map.updateMarkerSize();$("#typeOverlayTrigger").data("overlay").close();return false});$("#chooseTypeForm #submitButton").click(function(h){h.preventDefault();var g=$("input[name=selectedType]:checked","#chooseTypeForm");if(g==null||parseInt(g.val())==-1){Legato.map.unfilterMarkers()}else{Legato.map.filterMarkers(parseInt(g.val()))}$("#typeOverlayTrigger").data("overlay").close();return false});$("#typeOverlayTrigger").click(function(g){if(!Legato.map.isEarthCurrentlyEnabled){$("#typeOverlay").overlay({mask:"gray",effect:"apple",closeOnClick:true,load:true})}return false});$("#helpText").click(function(g){if(!Legato.map.isEarthCurrentlyEnabled){$("#helpOverlay").overlay({mask:"gray",effect:"apple",closeOnClick:true,onBeforeLoad:function(){var h=this.getOverlay().find(".modalContentWrap");h.load($("#helpText").attr("href"))},load:true})}return false});$("#problems").click(function(g){$.cookie(mapVersionCookieName,"true",cookieSettings);cookieCheck()});$("#trybeta").click(function(g){$.removeCookie(mapVersionCookieName,cookieSettings);cookieCheck()});if($.browser.msie&&$.browser.version<=8){$("#logo-wrap").css({marginTop:0})}else{setTimeout(function(){$("#logo-wrap").animate({"margin-top":"0px",opacity:1},400,"easeOutExpo")},300);var b=$("#insShown");b.delay(200).animate({opacity:1},650);if(b.length>0){var a=$(b.find("p")[0]);var f=a.text().replace(/[^\d]/g,"");var e=parseInt(f,10);a.text("0");d(a,e)}}function d(h,q){var m,l,n,p,o,g=0;var k=setInterval(function(){g+=(q-g)*0.15;o=Math.round(g);n=o.toString().split("");p="";m=n.length;l=0;while(--m>=0){p=(m>0&&(l++%3==2)?",":"")+n[m]+p}h.text(p);if(o>=q){clearInterval(k)}},1000/30)}setTimeout(function(){$("footer").delay(300).animate({bottom:"0px"},300,"easeOutCirc")},300)});function changeUrlToLastDir(){var a=window.location.href;var b=0;if(a[a.length-1]=="/"){b=1}else{if(a[a.length-1]=="#"){if(a[a.length-2]=="/"){b=2}else{b=1}}}return a.substr(0,a.length-b)}String.prototype.reverse=function(){return this.split("").reverse().join("")};function redirectToMap(a){var b=changeUrlToLastDir();if(a){window.location.href=b+"/old";return}var c=b.reverse().indexOf("/");b=b.substr(0,b.length-c-1);window.location.href=b};